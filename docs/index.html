<!DOCTYPE html>
<html>
<head>
<title>CIFAR Classifier with TensorFlow</title>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
</head>

<body>
<div class="container">
    <div class="row">
        <div class="col-md-12">
            <h3>Convolutional Neural Networks with TensorFlow for Classifying CIFAR10 Data</h3>
            <p>Eric Scuccimarra (skooch@gmail.com)</p>
        </div>
        <div class="col-md-12">
            <h4>Summary</h4>
            <hr>
            <p>I created and tested several convolution neural network models with TensorFlow to classify the CIFAR 10 data. The process and results are described below.
        </div>
        <div class="col-md-12">
            <h4>Models</h4>
            <hr>
            <p>I started with four models, which were trained for 50 epochs each. The initial models are detailed <a href="#models">below.</a> Model 1 was very similar to the model described in the <a href="https://www.tensorflow.org/tutorials/deep_cnn">TensorFlow Deep CNN tutorial</a>, with the local response normalization with batch normalization.
            
        </div>
        <div class="col-md-12">
            <h4>Training</h4>
            <hr>
            <p>I used the CIFAR-10 60k data, with 50,000 images used for training and the remaining 10,000 split evenly between validation and test data. The data was downloaded from <a href="http://www.cs.toronto.edu/~kriz/cifar.html" target="_blank">http://www.cs.toronto.edu/~kriz/cifar.html</a>.
            <p>The loss function was cross entropy, softmax was used to generate predictions and then the predictions were compared to the labels to determine accuracy.
            
            <h4>Model Selection</h4>
            <p>After training the initial models, the results were compared and the models were updated in an attempt to make them perform better. The worst performing models were discarded, and the training process repeated until no significant improvement could be obtained by changing the models.
            <p>A total of about 15 models were tested and evaluated during the process. I ended up with one model which I was not able to improvie upon substantially. At this point I began optimizing that model's hyperparameters to tune the performance.
            <p>By the time I got to optimizing the model the time required for training on my laptop was prohibitive, so I began training the model on <a href="https://colab.research.google.com">Google CoLaboratory</a> where I was able to train the models in approximately 1/10 of the time required on my laptop. 
            <p>After testing about fifteen models, with several variations of each model also evaluated, an architecture was selected. This is detailed <a href="#final_model">below.</a>
                   
            <h4>Optimization</h4>
            <p>Once an architecture had been selected I proceeded to optimize the hyperparameters, specifically the learning rate and regularization rate. During the model selection process I had tested seven different learning rates before settling on one which was used to compare the models. Now the learning rate was tuned by training the model through 100 epochs and comparing the results.
            <p>The final learning rate selected was learning rate "f", which was an exponential non-staircase decay:
            <ul>
                <li>Starting rate: 0.005
                <li>Decays every 100 epochs
                <li>Decays to 0.25
            </ul>
            <p>The next hyperparameter to be tuned was the lambda for regularization. To tune this the model was trained through 200 epochs with seven different candidates.
            
            <p>
        </div>
        <div class="col-md-12">
            <a name="final_model"></a>
            <h4>Final Model</h4>
            <hr>
            <h5>Model 7.9.1fr</h5>
            <div class="row">
                <div class="col-md-4">
                    <ol>
                        <li>Conv 1
                            <ol>
                                <li>64 5x5 units with a stride of 1</li>
                                <li>Batch normalization</li>
                                <li>Relu activation</li>
                                <li>Dropout at 10%</li>
                            </ol>
                        </li>
                        <li>Conv 2
                            <ol>
                                <li>64 5x5 units with a stride of 1</li>
                                <li>Batch normalization</li>
                                <li>Relu activation</li>
                            </ol>
                        </li>
                        <li>Max Pool 1 size 2x2 with stride 2
                            <ol>
                                <li>Dropout at 10%</li>
                            </ol>
                        </li>
                        <li>Conv 3
                            <ol>
                                <li>96 4x4 units with a stride of 1</li>
                                <li>Batch normalization</li>
                                <li>Relu activation</li>
                                <li>Dropout at 10%</li>
                            </ol>
                        </li>
                        <li>Conv 4
                            <ol>
                                <li>96 4x4 units with a stride of 1</li>
                                <li>Batch normalization</li>
                                <li>Relu activation</li>
                            </ol>
                        </li>
                        <li>Max Pool 2 size 2x2 with stride 2
                            <ol>
                                <li>Dropout at 10%</li>
                            </ol>
                        </li>
                        <li>Conv 5
                            <ol>
                                <li>128 3x3 units with a stride of 1</li>
                                <li>Batch normalization</li>
                                <li>Relu activation</li>
                                <li>Dropout at 10%</li>
                            </ol>
                        </li>
                        <li>Conv 6
                            <ol>
                                <li>128 3x3 units with a stride of 1</li>
                                <li>Batch normalization</li>
                                <li>Relu activation</li>
                            </ol>
                        </li>
                        <li>Max Pool 3 size 2x2 with stride 2
                            <ol>
                                <li>Dropout at 10%</li>
                            </ol>
                        </li>
                        <li>Flatten output
                            <ol>
                                <li>Dropout at 10%</li>
                            </ol>
                        </li>
                        <li>Fully connected layer 1 with 1024 units
                            <ol>
                                <li>Relu activation
                                <li>Dropout at 10%
                            </ol>
                        <li>Fully connected layer 2 with 512 units and relu activation</li>
                        <li>Logits</li>
                        <li>Mean Cross Entropy
                        <li>Loss = mean xentropy + regularization losses
                        <li>Adam Optimizer minimizing loss
                    </ol>
                </div>
                <div class="col-md-8">
                    <img src="model_1.png" style="width: 100%;">
                </div>
            </div>
        </div>
            <h5>Model 2</h5>
            <div class="row">
                <div class="col-md-4">
                    <ol>
                        <li>Conv 1
                        <ol>
                        <li>32 3x3 units with a stride of 2</li>
                        <li>Batch normalization</li>
                        <li>Relu activation</li>
                        </ol>
                        </li>
                        <li>Conv 2
                        <ol>
                        <li>32 3x3 units with a stride of 1</li>
                        <li>Batch normalization</li>
                        <li>Relu activation</li>
                        </ol>
                        </li>
                        <li>Max Pool 1 2x2 with stride of 1
                        <ol>
                        <li>Dropout at 0.125</li>
                        </ol>
                        </li>
                        <li>Conv 3
                        <ol>
                        <li>64 3x3 units with stride of 2</li>
                        <li>Batch normalization</li>
                        <li>Relu activation</li>
                        </ol>
                        </li>
                        <li>Conv 4
                        <ol>
                        <li>64 3x3 units with a stride of 1</li>
                        <li>Batch normalization</li>
                        <li>Relu activation</li>
                        </ol>
                        </li>
                        <li>Max Pool 2 3x3 with stride of 2
                        <ol>
                        <li>Dropout at 0.125</li>
                        </ol>
                        </li>
                        <li>Flatten output
                        <ol>
                        <li>Dropout at 0.125</li>
                        </ol>
                        </li>
                        <li>Fully connected layer 1
                        <ol>
                        <li>512 units with relu activation</li>
                        <li>Dropout at 0.25</li>
                        </ol>
                        </li>
                        <li>Logits</li>
                    </ol>
                </div>
                <div class="col-md-8">
                    <img src="model_2.png" style="width: 100%;">
                </div>
            </div>
        </div>
            <h5>Model 3</h5>
            <div class="row">
                <div class="col-md-4">
                    <ol>
                        <li>Conv 1
                        <ol>
                        <li>32 3x3 units with a stride of 1</li>
                        <li>Batch normalization</li>
                        <li>Relu activation</li>
                        </ol>
                        </li>
                        <li>Conv 2
                        <ol>
                        <li>32 3x3 units with a stride of 1</li>
                        <li>Batch normalization</li>
                        <li>Relu activation</li>
                        </ol>
                        </li>
                        <li>Max Pool 1 2x2 with stride of 2
                        <ol>
                        <li>Dropout at 0.1</li>
                        </ol>
                        </li>
                        <li>Conv 3
                        <ol>
                        <li>64 3x3 units with stride of 1</li>
                        <li>Batch normalization</li>
                        <li>Relu activation</li>
                        <li>Dropout at 0.1</li>
                        </ol>
                        </li>
                        <li>Conv 4
                        <ol>
                        <li>64 3x3 units with a stride of 1</li>
                        <li>Batch normalization</li>
                        <li>Relu activation</li>
                        </ol>
                        </li>
                        <li>Max Pool 2 2x2 with stride of 2</li>
                        <li>Conv 5
                        <ol>
                        <li>128 3x3 units with stride of 1</li>
                        <li>Relu activation</li>
                        <li>Dropout at 0.1</li>
                        </ol>
                        </li>
                        <li>Conv 6
                        <ol>
                        <li>128 3x3 units with a stride of 1</li>
                        <li>Batch normalization</li>
                        <li>Relu activation</li>
                        </ol>
                        </li>
                        <li>Max Pool 3 2x2 with stride of 2</li>
                        <li>Flatten output
                        <ol>
                        <li>Dropout at 0.1</li>
                        </ol>
                        </li>
                        <li>Fully connected layer 1
                        <ol>
                        <li>1024 units with relu activation</li>
                        <li>Dropout at 0.1</li>
                        </ol>
                        </li>
                        <li>Logits</li>
                    </ol>
                </div>
                <div class="col-md-8">
                    <img src="model_3.png" style="width: 100%;">
                </div>
            </div>
        </div>
        
            <h5>Model 4</h5>
            <div class="row">
                <div class="col-md-4">
                    <ol>
                        <li>Conv 1
                        <ol>
                        <li>32 3x3 units with a stride of 1</li>
                        <li>Batch normalization</li>
                        <li>Relu activation</li>
                        </ol>
                        </li>
                        <li>Conv 2
                        <ol>
                        <li>32 3x3 units with a stride of 1</li>
                        <li>Batch normalization</li>
                        <li>Relu activation</li>
                        </ol>
                        </li>
                        <li>Max Pool 1 2x2 with stride of 2
                        <ol>
                        <li>Dropout at 0.125</li>
                        </ol>
                        </li>
                        <li>Conv 3
                        <ol>
                        <li>64 3x3 units with stride of 1</li>
                        <li>Batch normalization</li>
                        <li>Relu activation</li>
                        </ol>
                        </li>
                        <li>Conv 4
                        <ol>
                        <li>64 3x3 units with a stride of 1</li>
                        <li>Batch normalization</li>
                        <li>Relu activation</li>
                        </ol>
                        </li>
                        <li>Max Pool 2 2x2 with stride of 2
                        <ol>
                        <li>Dropout at 0.125</li>
                        </ol>
                        </li>
                        <li>Fully connected layer 1
                        <ol>
                        <li>512 units with relu activation</li>
                        <li>Dropout at 0.25</li>
                        </ol>
                        </li>
                        <li>Logits</li>
                    </ol>
                </div>
                <div class="col-md-8">
                    <img src="model_4.png" style="width: 100%;">
                </div>
            </div>
        </div>
        <div class="col-md-12">
            <a name="models"></a>
            <h4>Initial Models</h4>
            <hr>
            <h5>Model 1</h5>
            <p>This is essentially the same model described in the TensorFlow <a href="https://www.tensorflow.org/tutorials/deep_cnn" target="_blank">deep CNN tutorial.</a> A few minor changes have been made.
            <div class="row">
                <div class="col-md-4">
                    <ol>
                        <li>Conv 1
                        <ol>
                        <li>64 5x5 units with a stride of 1</li>
                        <li>Batch normalization</li>
                        <li>Relu activation</li>
                        </ol>
                        </li>
                        <li>Max Pool 1 size 3x3 with stride 2
                        <ol>
                        <li>Dropout at .125</li>
                        </ol>
                        </li>
                        <li>Conv 2
                        <ol>
                        <li>64 5x5 units with a stride of 1</li>
                        <li>Batch normalization</li>
                        <li>Relu activation</li>
                        </ol>
                        </li>
                        <li>Max Pool 2 size 3x3 with stride 2
                        <ol>
                        <li>Dropout at 0.125</li>
                        </ol>
                        </li>
                        <li>Flatten output
                        <ol>
                        <li>Dropout at 0.25</li>
                        </ol>
                        </li>
                        <li>Fully connected layer 1 with 384 units
                        <ol>
                        <li>Batch normalization</li>
                        <li>Relu activation</li>
                        </ol>
                        </li>
                        <li>Fully connected layer 2 with 192 units
                        <ol>
                        <li>Dropout at 0.25</li>
                        </ol>
                        </li>
                        <li>Logits</li>
                    </ol>
                </div>
                <div class="col-md-8">
                    <img src="model_1.png" style="width: 100%;">
                </div>
            </div>
        </div>
        <div class="col-md-12">
            <h5>Model 2</h5>
            <div class="row">
                <div class="col-md-4">
                    <ol>
                        <li>Conv 1
                        <ol>
                        <li>32 3x3 units with a stride of 2</li>
                        <li>Batch normalization</li>
                        <li>Relu activation</li>
                        </ol>
                        </li>
                        <li>Conv 2
                        <ol>
                        <li>32 3x3 units with a stride of 1</li>
                        <li>Batch normalization</li>
                        <li>Relu activation</li>
                        </ol>
                        </li>
                        <li>Max Pool 1 2x2 with stride of 1
                        <ol>
                        <li>Dropout at 0.125</li>
                        </ol>
                        </li>
                        <li>Conv 3
                        <ol>
                        <li>64 3x3 units with stride of 2</li>
                        <li>Batch normalization</li>
                        <li>Relu activation</li>
                        </ol>
                        </li>
                        <li>Conv 4
                        <ol>
                        <li>64 3x3 units with a stride of 1</li>
                        <li>Batch normalization</li>
                        <li>Relu activation</li>
                        </ol>
                        </li>
                        <li>Max Pool 2 3x3 with stride of 2
                        <ol>
                        <li>Dropout at 0.125</li>
                        </ol>
                        </li>
                        <li>Flatten output
                        <ol>
                        <li>Dropout at 0.125</li>
                        </ol>
                        </li>
                        <li>Fully connected layer 1
                        <ol>
                        <li>512 units with relu activation</li>
                        <li>Dropout at 0.25</li>
                        </ol>
                        </li>
                        <li>Logits</li>
                    </ol>
                </div>
                <div class="col-md-8">
                    <img src="model_2.png" style="width: 100%;">
                </div>
            </div>
        </div>
        <div class="col-md-12">
            <h5>Model 3</h5>
            <div class="row">
                <div class="col-md-4">
                    <ol>
                        <li>Conv 1
                        <ol>
                        <li>32 3x3 units with a stride of 1</li>
                        <li>Batch normalization</li>
                        <li>Relu activation</li>
                        </ol>
                        </li>
                        <li>Conv 2
                        <ol>
                        <li>32 3x3 units with a stride of 1</li>
                        <li>Batch normalization</li>
                        <li>Relu activation</li>
                        </ol>
                        </li>
                        <li>Max Pool 1 2x2 with stride of 2
                        <ol>
                        <li>Dropout at 0.1</li>
                        </ol>
                        </li>
                        <li>Conv 3
                        <ol>
                        <li>64 3x3 units with stride of 1</li>
                        <li>Batch normalization</li>
                        <li>Relu activation</li>
                        <li>Dropout at 0.1</li>
                        </ol>
                        </li>
                        <li>Conv 4
                        <ol>
                        <li>64 3x3 units with a stride of 1</li>
                        <li>Batch normalization</li>
                        <li>Relu activation</li>
                        </ol>
                        </li>
                        <li>Max Pool 2 2x2 with stride of 2</li>
                        <li>Conv 5
                        <ol>
                        <li>128 3x3 units with stride of 1</li>
                        <li>Relu activation</li>
                        <li>Dropout at 0.1</li>
                        </ol>
                        </li>
                        <li>Conv 6
                        <ol>
                        <li>128 3x3 units with a stride of 1</li>
                        <li>Batch normalization</li>
                        <li>Relu activation</li>
                        </ol>
                        </li>
                        <li>Max Pool 3 2x2 with stride of 2</li>
                        <li>Flatten output
                        <ol>
                        <li>Dropout at 0.1</li>
                        </ol>
                        </li>
                        <li>Fully connected layer 1
                        <ol>
                        <li>1024 units with relu activation</li>
                        <li>Dropout at 0.1</li>
                        </ol>
                        </li>
                        <li>Logits</li>
                    </ol>
                </div>
                <div class="col-md-8">
                    <img src="model_3.png" style="width: 100%;">
                </div>
            </div>
        </div>
        <div class="col-md-12">
            <h5>Model 4</h5>
            <div class="row">
                <div class="col-md-4">
                    <ol>
                        <li>Conv 1
                        <ol>
                        <li>32 3x3 units with a stride of 1</li>
                        <li>Batch normalization</li>
                        <li>Relu activation</li>
                        </ol>
                        </li>
                        <li>Conv 2
                        <ol>
                        <li>32 3x3 units with a stride of 1</li>
                        <li>Batch normalization</li>
                        <li>Relu activation</li>
                        </ol>
                        </li>
                        <li>Max Pool 1 2x2 with stride of 2
                        <ol>
                        <li>Dropout at 0.125</li>
                        </ol>
                        </li>
                        <li>Conv 3
                        <ol>
                        <li>64 3x3 units with stride of 1</li>
                        <li>Batch normalization</li>
                        <li>Relu activation</li>
                        </ol>
                        </li>
                        <li>Conv 4
                        <ol>
                        <li>64 3x3 units with a stride of 1</li>
                        <li>Batch normalization</li>
                        <li>Relu activation</li>
                        </ol>
                        </li>
                        <li>Max Pool 2 2x2 with stride of 2
                        <ol>
                        <li>Dropout at 0.125</li>
                        </ol>
                        </li>
                        <li>Fully connected layer 1
                        <ol>
                        <li>512 units with relu activation</li>
                        <li>Dropout at 0.25</li>
                        </ol>
                        </li>
                        <li>Logits</li>
                    </ol>
                </div>
                <div class="col-md-8">
                    <img src="model_4.png" style="width: 100%;">
                </div>
            </div>
        </div>
        <div class="col-md-12">
            <h4>References and Notes</h4>
            <ol>
                <li>Sergey Ioffe, Christian Szegedy, Batch Normalization: Accelerating Deep Network Training by Reducing Internal Covariate Shift (2015)  arXiv:1502.03167v3 [cs.LG], URL <a href="https://arxiv.org/abs/1502.03167">https://arxiv.org/abs/1502.03167</a>
                <li>Srivastava, et al, Dropout: A Simple Way to Prevent Neural Networks from Overfitting (2014), Journal of Machine Learning Research 15 (2014) 1929-1958, URL <a href="http://www.jmlr.org/papers/volume15/srivastava14a/srivastava14a.pdf?utm_content=buffer79b43&utm_medium=social&utm_source=twitter.com&utm_campaign=buffer">http://www.jmlr.org/papers/volume15/srivastava14a/srivastava14a.pdf?utm_content=buffer79b43&utm_medium=social&utm_source=twitter.com&utm_campaign=buffer</a>
            </ol>
        </div>
    </div>
</div>

</body>
</html>